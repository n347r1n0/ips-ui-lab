# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.









# FloatingChipWheel — план улучшений

## P1 · UX-полировка (ощущение и отклик)

* [ ] Мягкий **щелчок-снап**

  * *Что:* короткий haptic/звук + `scale`-pulse активной ячейки.
  * *Как:* на `onSnapCommit(id)` → `navigator.vibrate(8)` (если доступно) + опциональный аудио-хук; активной иконке дать `transform: scale(1.06–1.10)` на 120–160 ms ease-out.
  * *Готово когда:* отклик не наслаивается при быстрых сериях; pulse не «раздувает» хит-зону.

* [x] **Активная ячейка** как единственный акцент

  * *Что:* иконка остаётся белой; для активной — мягкая золотая подсветка/halo и лёгкий `scale`.
  * *Как:* через скин (`pokerSkin.decorateIcon`) c токенами интенсивности.
  * *Статус:* сделано (gold halo + scale), цвет иконки возвращён к белому.

* [ ] **Дуга-индикатор** при драге

  * *Что:* тонкая золотая «наводка» в центральной зоне; плавное появление/затухание.
  * *Как:* отдельный слой `conic-gradient` с анимируемой `opacity` (включается только при активном жесте).
  * *Готово когда:* без рывков, не перекрывает иконки.

* [ ] **Кликабельная подпись** секции

  * *Что:* тап по лейблу открывает компактный список/радиальный селектор; выбор → `snapTo(id)` **без** внешней синхры.
  * *Как:* локальный popover (портал), навигация клавиатурой; закрытие — по выбору/blur/esc.
  * *Готово когда:* не конфликтует со свайпом, не вызывает «флики».

* [ ] **Акцент-кольцо под активной иконкой (видимое)**

  * *Что:* вместо «размытого пятна» — чёткое тонкое золотое кольцо под активной иконкой.
  * *Как:* в `decorateIcon` добавить слой `radial-gradient(closest-side, transparent …, gold …, transparent …)` с настраиваемой толщиной через `skinProps`.
  * *Готово когда:* кольцо чёткое, без алиасинга и дрожания на «шве».

---

## P1.5 · Системные жесты и края экрана (iOS/Android Web)

* [ ] **Политика жестов** (`gesturePolicy`)

  * *Что:* проп `gesturePolicy: 'greedy' | 'polite' | 'edge-safe'` (по умолчанию `edge-safe`).
  * *Как:* в `FloatingChipWheel` адаптировать deadzone/захват указателя:

    * `greedy` — сразу `touch-action: none` на корне, захват `setPointerCapture`, агрессивно подавляем скролл.
    * `polite` — ждём превышения `deadzonePx`, потом включаем блокировки.
    * `edge-safe` — как `polite`, плюс защита от краёв (см. ниже).
  * *Готово когда:* переключение режима ощутимо меняет конкуренцию с системными жестами.

* [ ] **Edge-safe зона**

  * *Что:* не стартовать свайп, если `pointerdown` попал в охранную зону у краёв экрана.
  * *Как:* вычислять safe-area: `env(safe-area-inset-left/right/bottom)` + наш порог `edgeGuardPx` (например, 12–20 px). В этой зоне игнорировать первичный drag, но разрешать **tap-hold→drag** (удержание ≥120 ms).
  * *Готово когда:* жесты «назад»/home-indicator у iOS/Android не перехватываются колесом.

* [ ] **Жест «назад» от левого края (iOS Safari)**

  * *Что:* уважать системный back-swipe.
  * *Как:* если `clientX < edgeBackSwipePx` (например, 18–24 px), блокировать старт drag до `pointerup`; разрешить только tap.
  * *Готово когда:* back-swipe воспроизводимо работает даже при перекрытии колесом.

* [ ] **Pull-to-refresh / overscroll**

  * *Что:* не допускать P2R во время перетаскивания колеса.
  * *Как:* на время активного drag: `document.body.style.overscrollBehavior = 'none'` и возврат после; `root.style.touchAction = 'none'`.
  * *Готово когда:* нет «отскока»/P2R при drag в любой точке колеса.

* [ ] **Динамический вьюпорт и адресная строка iOS**

  * *Что:* колесо не «прыгает» при показе/скрытии браузерного UI.
  * *Как:* переводим позиционирование на `visualViewport` события (`resize/scroll`) + используем `dvh` вместо `vh`; учитываем `safe-area-inset-bottom` при вычислении `offset`.
  * *Готово когда:* позиция колеса стабильна при изменении UI браузера.

* [ ] **Автосмещение от home-indicator**

  * *Что:* не пересекаться с системным индикатором/панелью.
  * *Как:* если `dock` внизу — добавлять к `offset.y` `env(safe-area-inset-bottom) + marginPx`.
  * *Готово когда:* хит-зона не утыкается в home-indicator на iPhone без кнопки.

* [ ] **Fallback: tap-hold→drag**

  * *Что:* «вежливый» запуск перетаскивания.
  * *Как:* при удержании на месте ≥120–180 ms — активировать drag даже в edge-safe зоне.
  * *Готово когда:* можно надёжно начать перетягивание рядом с краями.

* [ ] **Матрица регресса по жестам**

  * *Что:* чек-лист устройств/сценариев: iOS Safari (back-swipe, адресная строка up/down), Android Chrome (P2R), мобильный Chrome/Firefox, Desktop touch-эмуляция.
  * *Готово когда:* сценарии воспроизводимы; фиксы проверяются за 10–15 сек.

---

## P2 · Визуал/скины

* [ ] **Стеклянная палитра в токены**

  * *Что:* `--chip-glass-red`, `--chip-glass-ivory`, `--chip-glass-gap`, интенсивности/blur.
  * *Готово когда:* все цвета/альфы вынесены из JSX; легко крутятся темой.

* [ ] **Настройка «визуальных клиньев»**

  * *Что:* `visualWedgeDeg` (по умолчанию = `stepDeg`), чтобы узор делать чаще/реже пунктов без ломки логики.
  * *Готово когда:* узор стабильный при любом значении; «шва» не видно.

* [ ] **Лёгкий anti-bleed**

  * *Что:* микросмещение/оверлап клиньев на 0.5–1° и аккуратные разделители.
  * *Готово когда:* нет «просветов» на ретине и при масштабировании.

* [ ] **Периметр активного клина**

  * *Что:* тонкий золотой контур по всему периметру активного сектора **включая** оба разделителя с соседями.
  * *Как:* угловое окно (`conic-gradient` на сектор) + две радиальные дуги (внутр./внешн.) + подчёркивание разделителей.
  * *Статус:* отложено (эксперимент отменён).

---

## P2 · Надёжность/синхронизация

* [ ] «Единый источник правды» в API

  * *Что:* `onSnapCommit(id)` (момент выбора пользователем) и `onExternalSync(id)` (подвод к внешнему состоянию).
  * *Готово когда:* внешние апдейты игнорируются во время интеракции/settle, фликов нет.

* [ ] Тест-матрица «шва»

  * *Что:* автопроверки для разных `stepDeg` (кратно/некратно 360), `dock`, DPR.
  * *Готово когда:* визуальные артефакты не воспроизводятся.

---

## P3 · Доступность

* [ ] Полная ARIA-навигация

  * *Что:* `role="tablist"` у колеса, `role="tab"` у иконок, `aria-selected`, клавиши `←/→/Enter/Escape`.
  * *Готово когда:* WCAG-навигация проходит без мыши.

* [ ] Reduced-motion дружелюбность

  * *Что:* все анимации уважают `prefers-reduced-motion`.
  * *Готово когда:* на RMP переходы мгновенные.

---

## P3 · Производительность/Dev-опыт

* [ ] Безопасные градиенты

  * *Что:* максимум 3–4 слоя conic/radial; никаких DOM-узлов «на сектор».
  * *Готово когда:* FPS стабилен на бюджетных девайсах.

* [ ] Playground для скинов

  * *Что:* мини-страница с лайв-контроллами (`stepDeg`, `phaseDeg`, альфы стекла).
  * *Готово когда:* «шов»/сдвиг воспроизводится и диагностируется за 10 сек.

---

### Примечания к текущему состоянию

* Временный стабильный пресет: `stepDeg = 36` (чётное число визуальных клиньев) + фазировка через `phaseDeg`.
* Узор и иконки синхронизированы одной фазой: `phase = center + phaseDeg − stepF * stepDeg`.
* Акцент активной ячейки: золотая подложка-halo + лёгкий `scale` (иконка — белая).
